<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Faturamento</title>
    <link rel="stylesheet" href="/static/css/TelaFaturamentoGeral.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-dark text-white">

    <!-- Cabeçalho-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-success mb-1 rounded py-1">
        <div class="container-fluid d-flex justify-content-center">
            <span class="navbar-brand mb-0" style="font-size:1.5rem; font-weight:bold;">Cronograma</span>
        </div>
    </nav>

    <!-- Botões / Filtros -->
    <div class="container-fluid mb-2">
        <div class="d-flex flex-wrap align-items-center bg-dark rounded p1">
            <button class="btn btn-outline-light me-3 mb-0" id="Matriz">Matriz</button>
            <button class="btn btn-outline-light me-3 mb-0" id="Filial">Filial</button>
            <button class="btn btn-outline-light me-3 mb-0" id="Geral">Geral</button>
            <button class="btn btn-outline-light me-3 mb-0" id="Outros">Outros</button>
            <div class="dropdown">

                      <button id ="Cronogramas" class="btn btn-primary dropdown-toggle" type="button" id="menuCronograma" data-bs-toggle="dropdown" aria-expanded="false">
                        Cronogramas
                      </button>

                      <ul class="dropdown-menu" aria-labelledby="menuCronograma">
                        <li><a class="dropdown-item" href="/Cronograma_Inverno.html">Inverno</a></li>

                        <li><a class="dropdown-item" href="/Cronograma_Verao.html">Verão</a></li>

                        <li><a class="dropdown-item" href="/Cronograma_AltoVerao.html">Alto Verão</a></li>
                      </ul>
                </div>
 <!-- Espaço entre botões e status/filtro -->

            <div class="ms-auto d-flex align-items-center gap-5">

                    <!-- Status -->
                    <div class="d-flex align-items-center">
                    <label for="on-off" class="text-white me-2 mb-0 fw-bold">STATUS:</label>
                    <input type="checkbox" id="on-off" checked>
                    <span id="status" class="text-white ms-2">MENSAL</span>
                    </div>

                    <!-- Filtro de ano -->
                    <div class="d-flex align-items-center">
                    <label for="ano" class="text-white me-2 mb-0 fw-bold">ANO:</label>
                    <select id="box_ano" class="form-select form-select-sm">
                     <option value="2026" selected>2026</option>
                     <option value="2025" >2025</option>
                    <option value="2024">2024</option>
                    <option value="2023">2023</option>
                    </select>
                    </div>


            </div>
        </div>
    </div>
<div class="container-fluid p-0 mt-0">

    <div class="card shadow border-0">
        <div class="card-body text-center p-0">

            <img src="/static/imagens/planilha_Dashboard_Inverno.png"
                 class="img-fluid w-100"
                 alt="Print da Planilha">

        </div>
    </div>
</div>

</body>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/js/TelaFaturamentoColecoes.js"></script>

<script>
const onOffSwitch = document.getElementById("on-off");
const statusText = document.getElementById("status");
const altera_ano = document.getElementById("box_ano");

altera_ano.addEventListener("change", async () => {

        const ano = altera_ano.value;
        console.log(ano);
        anoSelecionado = ano;
        await Faturamento();


        if (statusText.innerText=="MENSAL"){

                criarTabelaEmbalagens(DadosFaturamento, 'Faturado', 'meta');
                createBarChart('Faturado', 'meta');

             }else{
                criarTabelaEmbalagens(DadosFaturamento, 'Fat.Acumulado', 'meta acum.');
                createBarChart('Fat.Acumulado', 'meta acum.');

             }

}
);

onOffSwitch.addEventListener("change", () => {
    if (onOffSwitch.checked) {
        statusText.innerText = "MENSAL";
        criarTabelaEmbalagens(DadosFaturamento, 'Faturado', 'meta');
        createBarChart('Faturado', 'meta');
        localStorage.setItem("dashboardStatus", "MENSAL");

    } else {
        statusText.innerText = "ACUMULADO";
        criarTabelaEmbalagens(DadosFaturamento, 'Fat.Acumulado', 'meta acum.');
        createBarChart('Fat.Acumulado', 'meta acum.');
        localStorage.setItem("dashboardStatus", "ACUMULADO");

    }
});

// Verifique o valor armazenado no localStorage
const localStorageStatus = localStorage.getItem("dashboardStatus");

if (localStorageStatus === "ACUMULADO") {
    // Se o valor estiver definido como "ACUMULADO", configure o botão para "ACUMULADO"
    onOffSwitch.checked = false;
    statusText.innerText = "ACUMULADO";
    window.addEventListener('load', async () => {
    await Faturamento();
    criarTabelaEmbalagens(DadosFaturamento, 'Fat.Acumulado', 'meta acum.');
    createBarChart('Fat.Acumulado', 'meta acum.');
    // Use uma função anônima para realizar o redirecionamento após 30 segundos.
    setTimeout(() => {
        window.location.href = "Cronograma_Verao.html";
    }, 20000);
});

} else {
    // Caso contrário, configure o botão para "MENSAL"
    onOffSwitch.checked = true;
    statusText.innerText = "MENSAL";
    window.addEventListener('load', async () => {
    await Faturamento();
    criarTabelaEmbalagens(DadosFaturamento, 'Faturado', 'meta');
    createBarChart('Faturado', 'meta');
    // Use uma função anônima para realizar o redirecionamento após 30 segundos.
    setTimeout(() => {window.location.href = "Cronograma_Verao.html";},15000);

});
}
</script>
</html>
